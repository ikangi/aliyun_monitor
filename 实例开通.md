# 阿里云国际版 CDT 最佳实践：抢占式实例 + OSS 镜像 + Python 自动化风控方案

本项目详细介绍了如何利用阿里云国际版（Alibaba Cloud International）的 **CDT（云数据传输）** 免费额度，配合 **抢占式实例（Preemptible Instance）** 和 **OSS 自定义镜像**，以极低的成本 获得每月 200GB 的 BGP 高速公网流量。

##  致谢

特别感谢 **Biliup 社区** 的大佬分享，本项目的灵感与部分核心思路来源于此：
* [https://bbs.biliup.rs/t/topic/46](https://bbs.biliup.rs/t/topic/46)

> **⚠️ 免责声明**：
> 1. 本方案利用的是阿里云当前的计费规则，规则随时可能变动，请以官方最新公告为准。
> 2. 抢占式实例存在“被强制释放”的风险，数据无价，请勿用于核心生产环境。
> 3. 请务必配置好[自动化监控脚本](https://github.com/10000ge10000/aliyun_monitor)以防止流量超标扣费。
> 
> 

---

##  核心概念：什么是 CDT 公网流量？

**CDT (Cloud Data Transfer)** 是阿里云提供的一种统一流量计费模式。

* **免费额度**：开通 CDT 后，国际站账号名下的 ECS 每月享有 **220GB** 的公网流量免费额度（其中 20GB 可用于中国大陆，200GB 限制非中国内地，即**香港/新加坡等亚太热门节点完全可用**）。
* **计费逻辑 (重要)**：
* **出入取最大 (Max In/Out)**：CDT 的计费流量通常取 **“流入流量”** 和 **“流出流量”** 中的**最大值**进行计算。
* **举例**：如果你下载了 100GB 文件（入），上传了 10GB 文件（出），系统将扣除 **100GB** 的免费额度。


* **线路质量**：走的不是普通线路，而是阿里云优质的 BGP 线路。在香港和日本，新加坡区域，直连国内速度极快。


---


> **⚠️ 关于监控的提示**：
> 本脚本调用的阿里云官方 CDT 接口查询的是 **“计费流量”**。由于 CDT 采用“出入取最大”规则，**下载流量也会导致监控读数增加**，从而触发关机保护，这是正常现象，旨在保护您的钱包。

---

## 🛠️ 准备工作

1. **账号准备**：
* 注册并登录阿里云国际站账号（需要非中国大陆手机号/邮箱，通常需要绑定海外信用卡或 PayPal）。
* 👉 **[点击前往阿里云国际站注册](https://account.alibabacloud.com/login/login.htm)**


2. **支付方式**：确保账号已绑定有效的支付方式（用于扣除极低的实例运行费）。

---

##  部署流程

### 第一步：开启 CDT 共享流量包 (至关重要)

如果不开启此项，流量将按昂贵的标准价格计费！

1. 登录阿里云控制台。
2. 在顶部搜索框输入 **“CDT”**，点击自动弹出的 **“控制台 > 云数据传输”**。
* 或者直接访问：[https://cdt.console.alibabacloud.com/overview](https://cdt.console.alibabacloud.com/overview)


3. 进入 CDT 工作台概览页。
4. **一键升级**：
* 检查页面上的“公网流量”或“云数据传输”子项。
* 如果显示“未开通”或“未升级”，请点击右上角的 **“一键升级”** 或 **“开通服务”** 按钮。
* 确认开通后，计费模式即刻生效。



### 第二步：开通 OSS 并上传 Alpine 镜像 (极致省钱)

为了进一步降低磁盘费用和系统资源占用，我们推荐使用 **Alpine Linux** 这种超轻量级系统。我们需要先将镜像上传到阿里云 OSS，再导入为 ECS 自定义镜像。

1. **下载 Alpine 虚拟化镜像**：
* 请直接前往本项目 Releases 页面下载特制的 ISO 镜像：
* 👉 **[点击下载 alpine-virt-3.23.2-x86_64.iso](https://github.com/10000ge10000/aliyun_monitor/releases/download/v1.0/alpine-virt-3.23.2-x86_64.iso)**


2. **开通 OSS 服务**：
* 控制台搜索 **“OSS”** (对象存储) 并开通。
* **创建 Bucket**：
* **区域**：必须与你稍后要购买 ECS 的区域一致（推荐 **中国香港** 或 **日本**）。
* **存储类型**：标准存储。
* **读写权限**：私有。




3. **上传镜像**：
* 进入刚才创建的 Bucket，点击“上传文件”，将刚才下载的 `.iso` 镜像文件上传。


4. **导入为 ECS 镜像**：
* 进入 **ECS 控制台** -> **实例与镜像** -> **镜像**。
* 点击 **“导入镜像”**。
* **OSS Object 地址**：选择刚才上传的 `.iso` 文件。
* **操作系统**：选择 Linux / Other Linux。
* **系统盘大小**：建议设置为 2GB（取决于阿里云最低限制）。
* 等待导入完成，你将获得一个自定义镜像 ID。



### 第三步：创建“抢占式”实例

1. 进入 ECS 购买页面 (创建实例)。
2. **付费模式**：选择 **抢占式实例 (Pay-As-You-Go)**。
3. **地域**：选择你上传镜像的区域（推荐 **中国香港**，回国速度最快）。
4. **实例规格**：
* **架构**：x86 计算。
* **分类**：选择 **“抢占式实例” (Preemptible Instance)**。
* **策略**：选择“无保护期”或默认策略（价格最低）。
* **规格选择**：筛选 **2 vCPU / 0.5 GiB** 或 **1 vCPU / 1 GiB** 的入门级实例（如 `e` 系列或 `t5/t6` 系列）。通常这种实例的时价低至 **$0.001/小时** 甚至更低。


5. **镜像**：
* 点击 **“自定义镜像”**，选择你在第二步导入的 Alpine 镜像。


6. **存储**：
* 选择 **ESSD Entry** 或 **高效云盘**。
* 容量拉到最低（通常自定义镜像允许 1GiB，越小越省钱）。


7. **公网 IP (核心步骤)**：
* **分配公网 IPv4 地址**：不勾选。


8. **安全组**：开放 SSH (22) 端口。

   
9. **下单**：确认费用（你会发现配置费用极低，流量费显示为 0 或按量，实际由 CDT 抵扣）。


---


### 第四步：创建弹性公网IP
* 👉 **[弹性公网IP](https://vpc.console.alibabacloud.com/eip/cn-hongkong/eips)**
* 创建并绑定实例
* 加入带宽包服务


---

## ❓ 常见问题 (FAQ)

**Q: 抢占式实例被释放了怎么办？**
A: 这是抢占式实例的特性。数据请务必通过 OSS 或其他方式实时备份。实例释放后，需要重新购买。

**Q: 为什么账单里还是有几分钱？**
A: 可能是因为你使用了超过 200G 的流量，或者是实例运行产生的小额计算费用。CDT 只免流量费，不免机器本身的钱。

**Q: 下载文件算流量吗？（重点注意）**
A: **算！** 根据实测，CDT 计费采用 **“双向取最大值”** 策略。

* 如果你主要用于**建站/跑服务**（主要是流出），则计算流出流量。
* 如果你主要用于**下载/拉取备份**（主要是流入），则计算流入流量。
* **警告**：请勿随意进行长时间的大带宽下载测速，这会迅速消耗你的 200G 免费额度。

---
